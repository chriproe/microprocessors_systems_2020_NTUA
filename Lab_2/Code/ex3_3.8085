	IN 10H			;switch off all LEDs
	LXI H,0AA0H		;address of first digit
	MVI A,06H
	MVI B,07H		;use register B as mask (0000 0111)
LOOP_BLANK:
	MVI M,10H
	INX H
	DCR A
	CPI 00H
	JNZ LOOP_BLANK

START:
	MVI C,FEH		;ROW 1
	CALL TAKE_ROW	
	CPI 03H
	JZ KEY_INST_STEP
	CPI 05H
	JZ KEY_FETCH_PC
	CPI 06H
	JZ KEY_HDWR_STEP
	
	MVI C,FDH		;ROW 2
	CALL TAKE_ROW	
	CPI 06H
	JZ KEY_RUN
	CPI 05H
	JZ KEY_FETCH_REG
	CPI 03H
	JZ KEY_FETCH_ADRS

	MVI C,FBH		;ROW 3
	CALL TAKE_ROW	
	CPI 06H
	JZ KEY_00
	CPI 05H
	JZ KEY_STORE
	CPI 03H
	JZ KEY_INCR

	MVI C,F7H		;ROW 4
	CALL TAKE_ROW	
	CPI 06H
	JZ KEY_01
	CPI 05H
	JZ KEY_02
	CPI 03H
	JZ KEY_03

	MVI C,EFH		;ROW 5
	CALL TAKE_ROW	
	CPI 06H
	JZ KEY_04
	CPI 05H
	JZ KEY_05
	CPI 03H
	JZ KEY_06

	MVI C,DFH		;ROW 6
	CALL TAKE_ROW	
	CPI 06H
	JZ KEY_07
	CPI 05H
	JZ KEY_08
	CPI 03H
	JZ KEY_09

	MVI C,BFH		;ROW 7
	CALL TAKE_ROW	
	CPI 06H
	JZ KEY_0A
	CPI 05H
	JZ KEY_0B
	CPI 03H
	JZ KEY_0C

	MVI C,7FH		;ROW 8
	CALL TAKE_ROW	
	CPI 06H
	JZ KEY_0D
	CPI 05H
	JZ KEY_0E
	CPI 03H
	JZ KEY_0F
	
	CALL DISPLAY_KEY
	JMP START

TAKE_ROW:
	MOV A,C
	STA 2800H
	LDA 1800H
	ANA B
	RET
	
DISPLAY_KEY:
	LXI D,0AA0H
	CALL STDM
	CALL DCD
	RET

KEY_INST_STEP:
	LXI H,0AA5H
	MVI M,08H
	LXI H,0AA4H
	MVI M,06H
	CALL DISPLAY_KEY
	JMP START

KEY_FETCH_PC:
	LXI H,0AA5H
	MVI M,08H
	LXI H,0AA4H
	MVI M,05H
	CALL DISPLAY_KEY
	JMP START

KEY_HDWR_STEP:
	LXI H,0AA5H
	MVI M,0FH
	LXI H,0AA4H
	MVI M,07H
	CALL DISPLAY_KEY
	JMP START

KEY_RUN:
	LXI H,0AA5H
	MVI M,08H
	LXI H,0AA4H
	MVI M,04H
	CALL DISPLAY_KEY
	JMP START

KEY_FETCH_REG:
	LXI H,0AA5H
	MVI M,08H
	LXI H,0AA4H
	MVI M,00H
	CALL DISPLAY_KEY
	JMP START

KEY_FETCH_ADRS:
	LXI H,0AA5H
	MVI M,08H
	LXI H,0AA4H
	MVI M,02H
	CALL DISPLAY_KEY
	JMP START

KEY_STORE:
	LXI H,0AA5H
	MVI M,08H
	LXI H,0AA4H
	MVI M,03H
	CALL DISPLAY_KEY
	JMP START

KEY_INCR:
	LXI H,0AA5H
	MVI M,08H
	LXI H,0AA4H
	MVI M,01H
	CALL DISPLAY_KEY
	JMP START

KEY_00:
	LXI H,0AA5H
	MVI M,00H
	LXI H,0AA4H
	MVI M,00H
	CALL DISPLAY_KEY
	JMP START

KEY_01:
	LXI H,0AA5H
	MVI M,00H
	LXI H,0AA4H
	MVI M,01H
	CALL DISPLAY_KEY
	JMP START

KEY_02:
	LXI H,0AA5H
	MVI M,00H
	LXI H,0AA4H
	MVI M,02H
	CALL DISPLAY_KEY
	JMP START

KEY_03:
	LXI H,0AA5H
	MVI M,00H
	LXI H,0AA4H
	MVI M,03H
	CALL DISPLAY_KEY
	JMP START

KEY_04:
	LXI H,0AA5H
	MVI M,00H
	LXI H,0AA4H
	MVI M,04H
	CALL DISPLAY_KEY
	JMP START

KEY_05:
	LXI H,0AA5H
	MVI M,00H
	LXI H,0AA4H
	MVI M,05H
	CALL DISPLAY_KEY
	JMP START

KEY_06:
	LXI H,0AA5H
	MVI M,00H
	LXI H,0AA4H
	MVI M,06H
	CALL DISPLAY_KEY
	JMP START

KEY_07:
	LXI H,0AA5H
	MVI M,00H
	LXI H,0AA4H
	MVI M,07H
	CALL DISPLAY_KEY
	JMP START

KEY_08:
	LXI H,0AA5H
	MVI M,00H
	LXI H,0AA4H
	MVI M,08H
	CALL DISPLAY_KEY
	JMP START

KEY_09:
	LXI H,0AA5H
	MVI M,00H
	LXI H,0AA4H
	MVI M,09H
	CALL DISPLAY_KEY
	JMP START

KEY_0A:
	LXI H,0AA5H
	MVI M,00H
	LXI H,0AA4H
	MVI M,0AH
	CALL DISPLAY_KEY
	JMP START

KEY_0B:
	LXI H,0AA5H
	MVI M,00H
	LXI H,0AA4H
	MVI M,0BH
	CALL DISPLAY_KEY
	JMP START

KEY_0C:
	LXI H,0AA5H
	MVI M,00H
	LXI H,0AA4H
	MVI M,0CH
	CALL DISPLAY_KEY
	JMP START

KEY_0D:
	LXI H,0AA5H
	MVI M,00H
	LXI H,0AA4H
	MVI M,0DH
	CALL DISPLAY_KEY
	JMP START

KEY_0E:
	LXI H,0AA5H
	MVI M,00H
	LXI H,0AA4H
	MVI M,0EH
	CALL DISPLAY_KEY
	JMP START

KEY_0F:
	LXI H,0AA5H
	MVI M,00H
	LXI H,0AA4H
	MVI M,0FH
	CALL DISPLAY_KEY
	JMP START

	END



